<div class="page">
  <header class="topbar">
    <div class="brand">
      <span class="logo">Δ</span>
      <h1>Dashboard Financeiro</h1>
    </div>

    <div class="filters-panel">
      <form class="filters" (ngSubmit)="submit()" [formGroup]="form">
        <mat-form-field appearance="outline" class="dense">
          <mat-label>Tipo</mat-label>
          <mat-select formControlName="tipoGrafico" required>
            <mat-option value="pie">Pizza</mat-option>
            <mat-option value="bar">Barras</mat-option>
            <mat-option value="line">Linhas</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="dense">
          <mat-label>Data inicial</mat-label>
          <input matInput [matDatepicker]="dpStart" formControlName="dataInicio" required>
          <mat-datepicker-toggle matSuffix [for]="dpStart"></mat-datepicker-toggle>
          <mat-datepicker #dpStart></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="dense">
          <mat-label>Data final</mat-label>
          <input matInput [matDatepicker]="dpEnd" formControlName="dataFim" required>
          <mat-datepicker-toggle matSuffix [for]="dpEnd"></mat-datepicker-toggle>
          <mat-datepicker #dpEnd></mat-datepicker>
        </mat-form-field>

        <button class="btn-primary" type="submit" [disabled]="loading()">
          <span class="material-icons">search</span>
          Pesquisar
        </button>
      </form>
    </div>
  </header>

  <!-- KPIs linha 1 -->
  <section class="kpis" *ngIf="!errorMsg()">
    <div class="stat-card kpi-1">
      <div class="stat-icon"><span class="material-icons">trending_up</span></div>
      <div class="stat-title">Total</div>
      <div class="stat-value">{{ stats.total | number:'1.2-2' }}</div>
      <div class="stat-foot">Soma dos valores</div>
    </div>

    <div class="stat-card kpi-2">
      <div class="stat-icon"><span class="material-icons">stacked_line_chart</span></div>
      <div class="stat-title">Média</div>
      <div class="stat-value">{{ stats.media | number:'1.2-2' }}</div>
      <div class="stat-foot">Média do período</div>
    </div>

    <div class="stat-card kpi-3">
      <div class="stat-icon"><span class="material-icons">north_east</span></div>
      <div class="stat-title">Máximo</div>
      <div class="stat-value">{{ stats.maximo | number:'1.2-2' }}</div>
      <div class="stat-foot">Maior ponto</div>
    </div>

    <div class="stat-card kpi-4">
      <div class="stat-icon"><span class="material-icons">south_east</span></div>
      <div class="stat-title">Mínimo</div>
      <div class="stat-value">{{ stats.minimo | number:'1.2-2' }}</div>
      <div class="stat-foot">Menor ponto</div>
    </div>
  </section>

  <!-- KPIs linha 2 (insights de negócio) -->
  <section class="kpis kpis-extra" *ngIf="!errorMsg()">
    <div class="stat-card kpi-5">
      <div class="stat-icon"><span class="material-icons">shopping_cart</span></div>
      <div class="stat-title">Vendas</div>
      <div class="stat-value">{{ stats.qtdVendas }}</div>
      <div class="stat-foot">Qtde de vendas no período</div>
    </div>

    <div class="stat-card kpi-6">
      <div class="stat-icon"><span class="material-icons">payments</span></div>
      <div class="stat-title">Ticket Médio</div>
      <div class="stat-value">{{ stats.ticketMedio | number:'1.2-2' }}</div>
      <div class="stat-foot">Valor médio por venda</div>
    </div>

    <div class="stat-card kpi-7">
      <div class="stat-icon"><span class="material-icons">star</span></div>
      <div class="stat-title">Top Produto</div>
      <div class="stat-value">{{ stats.produtoTopNome }}</div>
      <div class="stat-foot">
        Total {{ stats.produtoTopValor | number:'1.2-2' }}
      </div>
    </div>

    <div class="stat-card kpi-8">
      <div class="stat-icon"><span class="material-icons">category</span></div>
      <div class="stat-title">Top Categoria</div>
      <div class="stat-value">{{ stats.categoriaTopNome }}</div>
      <div class="stat-foot">
        Total {{ stats.categoriaTopValor | number:'1.2-2' }}
      </div>
    </div>
  </section>

  <!-- Gráfico -->
  <section class="panel">
    <div class="panel-head">
      <h3>Resultados por período</h3>
      <div class="panel-actions">
        <button class="btn-ghost" (click)="randomizeColors()" type="button">
          <span class="material-icons">palette</span> Cores
        </button>
        <button class="btn-ghost" (click)="submit()" [disabled]="loading()" type="button">
          <span class="material-icons">refresh</span> Atualizar
        </button>
      </div>
    </div>

    <div class="chart-area" [class.loading]="loading()">
      <canvas id="chartCanvas"></canvas>
      <div class="skeleton" *ngIf="loading()"></div>
    </div>

    <div class="messages">
      <div class="error" *ngIf="errorMsg()">{{ errorMsg() }}</div>
      <div class="info" *ngIf="infoMsg()">{{ infoMsg() }}</div>
    </div>
  </section>
</div>
